const data = {
    2002: {
        'Arch Linux': 12
    },
    2003: {
        'Arch Linux': 28
    },
    2004: {
        'Arch Linux': 55
    },
    2005: {
        'Arch Linux': 95
    },
    2006: {
        'Arch Linux': 150
    },
    2007: {
        'Arch Linux': 220
    },
    2008: {
        'Arch Linux': 310
    },
    2009: {
        'Arch Linux': 420,
        'Parabola GNU/Linux-libre': 8
    },
    2010: {
        'Arch Linux': 550,
        'Parabola GNU/Linux-libre': 25,
        'ArchBang': 12
    },
    2011: {
        'Arch Linux': 720,
        'Manjaro': 35,
        'Parabola GNU/Linux-libre': 45,
        'ArchBang': 28
    },
    2012: {
        'Arch Linux': 920,
        'Manjaro': 120,
        'ArchBang': 65,
        'Parabola GNU/Linux-libre': 75
    },
    2013: {
        'Arch Linux': 1150,
        'Manjaro': 280,
        'ArchBang': 140,
        'Parabola GNU/Linux-libre': 110,
        'BlackArch': 45
    },
    2014: {
        'Arch Linux': 1380,
        'Manjaro': 480,
        'ArchBang': 220,
        'Parabola GNU/Linux-libre': 150,
        'BlackArch': 65,
        'ArchStrike': 35
    },
    2015: {
        'Arch Linux': 1520,
        'Manjaro': 680,
        'ArchBang': 320,
        'Parabola GNU/Linux-libre': 185,
        'ArchLabs': 145,
        'Artix Linux': 95,
        'BlackArch': 85,
        'ArchStrike': 65,
        'ArcoLinux': 35,
        'EndeavourOS': 18,
        'Garuda Linux': 8,
        'RebornOS': 5
    },
    2016: {
        'Arch Linux': 1650,
        'Manjaro': 920,
        'ArchBang': 380,
        'Parabola GNU/Linux-libre': 240,
        'ArchLabs': 195,
        'Artix Linux': 135,
        'BlackArch': 110,
        'ArchStrike': 75,
        'ArcoLinux': 55,
        'EndeavourOS': 28,
        'Garuda Linux': 12,
        'RebornOS': 8
    },
    2017: {
        'Arch Linux': 1820,
        'Manjaro': 1280,
        'ArchBang': 450,
        'Parabola GNU/Linux-libre': 310,
        'ArchLabs': 250,
        'Artix Linux': 190,
        'BlackArch': 150,
        'ArchStrike': 95,
        'ArcoLinux': 80,
        'EndeavourOS': 55,
        'Garuda Linux': 25,
        'RebornOS': 15
    },
    2018: {
        'Arch Linux': 1850,
        'Manjaro': 1680,
        'ArchBang': 520,
        'Parabola GNU/Linux-libre': 380,
        'ArchLabs': 310,
        'Artix Linux': 250,
        'BlackArch': 195,
        'ArcoLinux': 155,
        'ArchStrike': 115,
        'EndeavourOS': 95,
        'Garuda Linux': 45,
        'RebornOS': 25
    },
    2019: {
        'Manjaro': 2150,
        'Arch Linux': 2080,
        'ArchBang': 580,
        'Parabola GNU/Linux-libre': 420,
        'EndeavourOS': 380,
        'ArchLabs': 360,
        'Artix Linux': 310,
        'ArcoLinux': 240,
        'BlackArch': 220,
        'Garuda Linux': 135,
        'ArchStrike': 125,
        'RebornOS': 50
    },
    2020: {
        'Manjaro': 2650,
        'Arch Linux': 2320,
        'EndeavourOS': 850,
        'Garuda Linux': 580,
        'ArchBang': 640,
        'Parabola GNU/Linux-libre': 480,
        'ArchLabs': 420,
        'Artix Linux': 360,
        'ArcoLinux': 320,
        'BlackArch': 260,
        'ArchStrike': 145,
        'RebornOS': 95
    },
    2021: {
        'Manjaro': 3120,
        'Arch Linux': 2580,
        'EndeavourOS': 1450,
        'Garuda Linux': 1180,
        'ArcoLinux': 640,
        'ArchBang': 700,
        'Parabola GNU/Linux-libre': 540,
        'ArchLabs': 480,
        'Artix Linux': 440,
        'BlackArch': 320,
        'RebornOS': 195,
        'ArchStrike': 165
    },
    2022: {
        'Manjaro': 3580,
        'Arch Linux': 2850,
        'EndeavourOS': 2120,
        'Garuda Linux': 1850,
        'ArcoLinux': 960,
        'Artix Linux': 640,
        'ArchBang': 840,
        'Parabola GNU/Linux-libre': 600,
        'ArchLabs': 540,
        'BlackArch': 380,
        'RebornOS': 285,
        'ArchStrike': 185
    },
    2023: {
        'Manjaro': 4020,
        'Arch Linux': 3120,
        'EndeavourOS': 2780,
        'Garuda Linux': 2520,
        'ArcoLinux': 1360,
        'Artix Linux': 960,
        'ArchBang': 880,
        'Parabola GNU/Linux-libre': 660,
        'ArchLabs': 600,
        'BlackArch': 440,
        'RebornOS': 360,
        'ArchStrike': 200
    },
    2024: {
        'Manjaro': 4450,
        'EndeavourOS': 3420,
        'Arch Linux': 3380,
        'Garuda Linux': 3180,
        'ArcoLinux': 1700,
        'Artix Linux': 1240,
        'ArchBang': 920,
        'Parabola GNU/Linux-libre': 720,
        'ArchLabs': 660,
        'BlackArch': 500,
        'RebornOS': 440,
        'ArchStrike': 220
    },
    2025: {
        'Manjaro': 4880,
        'EndeavourOS': 4050,
        'Garuda Linux': 3820,
        'Arch Linux': 3650,
        'ArcoLinux': 2040,
        'Artix Linux': 1500,
        'ArchBang': 960,
        'Parabola GNU/Linux-libre': 780,
        'ArchLabs': 720,
        'BlackArch': 560,
        'RebornOS': 520,
        'ArchStrike': 240
    }
};

const distroClasses = {
    'Arch Linux': 'arch-linux',
    'Manjaro': 'manjaro',
    'EndeavourOS': 'endeavouros',
    'ArcoLinux': 'arcolinux',
    'Artix Linux': 'artix',
    'Garuda Linux': 'garuda',
    'Parabola GNU/Linux-libre': 'parabola',
    'ArchBang': 'archbang',
    'ArchLabs': 'archlabs',
    'RebornOS': 'rebornos',
    'BlackArch': 'blackarch',
    'ArchStrike': 'archstrike'
};

const distroLogos = {
    'Arch Linux': 'src/logo/archlinux.png',
    'Manjaro': 'src/logo/Manjaro.png',
    'EndeavourOS': 'src/logo/EndeavourOS.png',
    'ArcoLinux': 'src/logo/Arcolinux.png',
    'Artix Linux': 'src/logo/Artix Linux.png',
    'Garuda Linux': 'src/logo/Garuda.png',
    'Parabola GNU/Linux-libre': 'src/logo/Parabola GNU‚ÅÑLinux-libre.png',
    'ArchBang': 'src/logo/ArchBang.png',
    'ArchLabs': 'src/logo/Archlabs.png',
    'RebornOS': 'src/logo/RebornOS.png',
    'BlackArch': 'src/logo/BlackArch.png',
    'ArchStrike': 'src/logo/ArchStrike.png'
};

const yearInfo = {
    2002: {
        title: 'The Birth of Arch Linux',
        details: [
            '<strong>March 11, 2002:</strong> Arch Linux was founded by Judd Vinet, inspired by CRUX Linux.',
            'Designed with a minimalist and simplicity philosophy - "Keep It Simple, Stupid" (KISS principle).',
            'Development of Pacman package manager began - a lightweight, fast, and dependency-aware package manager.',
            'Rolling release model adopted - continuous updates instead of versioned releases.',
            'User-centric approach embraced - users have full control over their system.',
            'Initial focus on i686 architecture (32-bit).',
            'First packages: base system, kernel, and essential tools.',
            'Community-driven development model established from the start.'
        ]
    },
    2003: {
        title: 'First Growth Year',
        details: [
            '<strong>Pacman:</strong> Package management system development continued with dependency resolution improvements.',
            'AUR (Arch User Repository) concept created - allowing users to share PKGBUILD scripts.',
            'Community support began to grow - first active users and contributors joined.',
            'Documentation efforts started - ArchWiki foundation laid.',
            'First official mirrors established in North America and Europe.',
            'Package repository structure standardized.',
            'Installation process documented and simplified.',
            'Initial community forums and IRC channels created.'
        ]
    },
    2004: {
        title: 'Infrastructure Improvements',
        details: [
            '<strong>Pacman 2.0:</strong> Major updates implemented with better package handling.',
            'Package database system improved - faster queries and updates.',
            'Dependency resolution algorithm enhanced - smarter conflict detection.',
            'Community continued to grow - reached hundreds of active users.',
            'First Arch Linux forums became active - bbs.archlinux.org launched.',
            'Repository mirror network expanded to 5+ mirrors worldwide.',
            'Package signing infrastructure planned and designed.',
            'ABS (Arch Build System) initial development started.'
        ]
    },
    2005: {
        title: 'Stability and Growth',
        details: [
            '<strong>Kernel:</strong> Linux kernel 2.6 support added with improved hardware compatibility.',
            'X11 and graphics driver support expanded - NVIDIA and ATI drivers added.',
            'Pacman performance optimizations made - faster package installation.',
            'Official repositories expanded - core, extra, and community repos established.',
            'Documentation system improved - ArchWiki structure refined.',
            'Package count exceeded 1,000 packages in official repositories.',
            'Installation ISO improved with better hardware detection.',
            'Community contributions increased significantly.'
        ]
    },
    2006: {
        title: 'Community Expansion',
        details: [
            '<strong>AUR:</strong> Arch User Repository opened for active use - thousands of user-contributed packages.',
            'makepkg system developed - standardized package building process.',
            'ABS (Arch Build System) improved - easier package creation and maintenance.',
            'Community contributions began to increase - active maintainer team formed.',
            'First Arch Linux conferences organized - ArchConf 2006 held.',
            'Package count in official repos exceeded 2,000 packages.',
            '64-bit (x86_64) architecture support development started.',
            'International community growth - users from 50+ countries.'
        ]
    },
    2007: {
        title: 'Modernization',
        details: [
            '<strong>Pacman 3.0:</strong> Major update released with improved dependency handling.',
            'Multilib support added - 32-bit libraries on 64-bit systems.',
            'Package signing system developed - GPG key infrastructure established.',
            'Repository structure reorganized - better package categorization.',
            '64-bit support fully integrated - x86_64 became primary architecture.',
            'Package count exceeded 5,000 in official repositories.',
            'AUR package count exceeded 3,000 user-contributed packages.',
            'Installation media improved with graphical installer options.'
        ]
    },
    2008: {
        title: 'Security and Performance',
        details: [
            '<strong>Security:</strong> Package signing and verification system activated - all packages now signed.',
            'Pacman parallel download support added - faster package installation.',
            'Repository mirror system expanded - 20+ mirrors worldwide.',
            'Community wiki received major update - comprehensive documentation.',
            'First official Arch Linux magazine published - community showcase.',
            'Package count exceeded 8,000 in official repositories.',
            'AUR package count exceeded 8,000 user-contributed packages.',
            'Trusted Users (TU) program established for AUR maintenance.'
        ]
    },
    2009: {
        title: 'Parabola GNU/Linux-libre',
        details: [
            '<strong>Parabola:</strong> Fully free software-focused Arch derivative established - 100% FSF-approved.',
            'Arch Linux: Preparations for systemd integration began - migration planning started.',
            'Pacman 4.0 development started - major rewrite planned.',
            'AUR package count exceeded 10,000 user-contributed packages.',
            'Community continued to grow - reached 10,000+ active users.',
            'Package count exceeded 10,000 in official repositories.',
            'Arch Linux moved to new infrastructure - better performance.',
            'First Arch-based distributions started appearing.'
        ]
    },
    2010: {
        title: 'ArchBang and New Derivatives',
        details: [
            '<strong>ArchBang:</strong> Lightweight Openbox-based Arch derivative released - minimal and fast.',
            'Arch Linux: Systemd migration plans announced - controversial decision made.',
            'Pacman 4.0 beta version tested - improved package handling.',
            'AUR package count exceeded 15,000 user-contributed packages.',
            'Community support and documentation continued to grow - ArchWiki expanded.',
            'Package count exceeded 12,000 in official repositories.',
            'Arch Linux ARM project started - port to ARM architecture.',
            'More Arch-based distributions emerged - ecosystem growing.'
        ]
    },
    2011: {
        title: 'The Birth of Manjaro',
        details: [
            '<strong>Manjaro:</strong> User-friendly Arch derivative established - making Arch accessible to beginners.',
            'Arch Linux: Systemd migration process began - gradual transition started.',
            'Pacman 4.0 official version released - major improvements in speed and reliability.',
            'AUR package count exceeded 20,000 user-contributed packages.',
            'Manjaro: Pamac package manager developed - graphical package management.',
            'Manjaro: First alpha releases with Xfce and KDE desktop environments.',
            'Package count exceeded 15,000 in official repositories.',
            'Arch Linux community reached 20,000+ active users.'
        ]
    },
    2012: {
        title: 'Manjaro\'s Rise',
        details: [
            '<strong>Manjaro:</strong> First stable release published - 0.8.0 "Ascella" release.',
            'Arch Linux: Systemd migration completed - sysvinit replaced by systemd.',
            'Manjaro: Xfce, KDE, GNOME desktop environments added - multiple options for users.',
            'AUR package count exceeded 30,000 user-contributed packages.',
            'Manjaro: MHWD (Manjaro Hardware Detection) developed - automatic driver installation.',
            'Manjaro: Rolling release with stable testing - best of both worlds.',
            'Package count exceeded 18,000 in official repositories.',
            'Arch Linux community reached 30,000+ active users.'
        ]
    },
    2013: {
        title: 'BlackArch and Security',
        details: [
            '<strong>BlackArch:</strong> Penetration testing-focused Arch derivative established - security researcher\'s dream.',
            'Arch Linux: Pacman 4.1 update released - bug fixes and improvements.',
            'Manjaro: Community support began to increase - growing user base.',
            'AUR package count exceeded 40,000 user-contributed packages.',
            'BlackArch: 1000+ security tools added - comprehensive penetration testing suite.',
            'BlackArch: Live ISO and installation options available.',
            'Package count exceeded 20,000 in official repositories.',
            'Arch Linux community reached 40,000+ active users.'
        ]
    },
    2014: {
        title: 'ArchStrike and Diversity',
        details: [
            '<strong>ArchStrike:</strong> Arch derivative for security researchers established - alternative to BlackArch.',
            'Arch Linux: Pacman 4.2 update released - performance improvements.',
            'Manjaro: ARM support added - Raspberry Pi and other ARM devices.',
            'AUR package count exceeded 50,000 user-contributed packages.',
            'Community continued to grow - reached 50,000+ active users.',
            'ArchStrike: Focus on security tools and penetration testing.',
            'Package count exceeded 22,000 in official repositories.',
            'More specialized Arch derivatives emerged - ecosystem diversification.'
        ]
    },
    2015: {
        title: 'New Generation Derivatives',
        details: [
            '<strong>ArchLabs:</strong> Minimal Openbox-based Arch derivative established - lightweight and fast.',
            '<strong>Artix Linux:</strong> Arch derivative running without systemd established - for systemd critics.',
            '<strong>ArcoLinux:</strong> Education-focused Arch derivative established - learning Arch made easy.',
            '<strong>EndeavourOS:</strong> Terminal-focused Arch derivative established - close to vanilla Arch.',
            '<strong>Garuda Linux:</strong> Performance-focused Arch derivative established - gaming and performance.',
            '<strong>RebornOS:</strong> User-friendly Arch derivative established - beautiful and functional.',
            'AUR package count exceeded 60,000 user-contributed packages.',
            'Package count exceeded 25,000 in official repositories.',
            'Arch Linux community reached 60,000+ active users.',
            'Multiple desktop environment options available across all derivatives.'
        ]
    },
    2016: {
        title: 'Development and Improvements',
        details: [
            '<strong>Arch Linux:</strong> Pacman 5.0 development started - major rewrite planned.',
            '<strong>Manjaro:</strong> First LTS release published - long-term support for stability.',
            '<strong>EndeavourOS:</strong> Developed as continuation of Antergos - community-driven project.',
            '<strong>Artix Linux:</strong> OpenRC, runit, s6 init systems added - multiple init options.',
            'AUR package count exceeded 70,000 user-contributed packages.',
            'Community support and documentation continued to grow - ArchWiki expanded.',
            'Package count exceeded 28,000 in official repositories.',
            'Arch Linux community reached 70,000+ active users.',
            'Better hardware support across all derivatives.',
            'Improved installation processes and user experience.'
        ]
    },
    2017: {
        title: 'Performance and Optimization',
        details: [
            '<strong>Arch Linux:</strong> Pacman 5.0 official version released - faster and more reliable.',
            '<strong>Manjaro:</strong> Wayland support added - modern display server support.',
            '<strong>Garuda Linux:</strong> Btrfs and zram optimizations made - better performance and snapshots.',
            '<strong>Artix Linux:</strong> Dinit init system added - another init option.',
            'AUR package count exceeded 80,000 user-contributed packages.',
            'Performance improvements made across all derivatives - faster boot times.',
            'Package count exceeded 30,000 in official repositories.',
            'Arch Linux community reached 80,000+ active users.',
            'Better gaming support - Steam and gaming tools improved.',
            'Enhanced security features across all distributions.'
        ]
    },
    2018: {
        title: 'Modernization and Innovations',
        details: [
            '<strong>Arch Linux:</strong> Pacman 5.1 update released - bug fixes and improvements.',
            '<strong>Manjaro:</strong> Flatpak and Snap support added - universal package formats.',
            '<strong>RebornOS:</strong> First stable release published - polished user experience.',
            '<strong>Garuda Linux:</strong> Garuda Gamer edition added - optimized for gaming.',
            'AUR package count exceeded 90,000 user-contributed packages.',
            'Wayland support expanded in many derivatives - modern display protocol.',
            'Package count exceeded 32,000 in official repositories.',
            'Arch Linux community reached 90,000+ active users.',
            'Better container support - Docker and Podman integration.',
            'Improved multimedia support - codecs and drivers.'
        ]
    },
    2019: {
        title: 'EndeavourOS\'s Rise',
        details: [
            '<strong>EndeavourOS:</strong> Grew with community support after Antergos closure - successful transition.',
            '<strong>Manjaro:</strong> First official ARM release published - Raspberry Pi support.',
            '<strong>Arch Linux:</strong> Pacman 5.2 update released - continued improvements.',
            '<strong>Garuda Linux:</strong> Garuda KDE Dr460nized edition added - beautiful themed desktop.',
            'AUR package count exceeded 100,000 user-contributed packages - major milestone.',
            'EndeavourOS: Xfce, i3, Plasma desktop environments added - multiple options.',
            'Package count exceeded 35,000 in official repositories.',
            'Arch Linux community reached 100,000+ active users.',
            'Better cloud integration - improved cloud tools and services.',
            'Enhanced privacy features - better user data protection.'
        ]
    },
    2020: {
        title: 'Garuda Linux\'s Growth',
        details: [
            '<strong>Garuda Linux:</strong> Gained popularity with performance-focused features - gaming and productivity.',
            '<strong>Manjaro:</strong> Version 20.0 released - major update with improvements.',
            '<strong>EndeavourOS:</strong> Community support continued to grow - active development.',
            '<strong>Arch Linux:</strong> Pacman 6.0 development started - next generation package manager.',
            'AUR package count exceeded 110,000 user-contributed packages.',
            'Garuda Linux: Btrfs snapshot system and automatic backup added - data protection.',
            'Package count exceeded 38,000 in official repositories.',
            'Arch Linux community reached 110,000+ active users.',
            'Better remote work support - improved video conferencing tools.',
            'Enhanced security features - better encryption and privacy tools.'
        ]
    },
    2021: {
        title: 'Innovation and Expansion',
        details: [
            '<strong>Arch Linux:</strong> Pacman 6.0 official version released - faster and more efficient.',
            '<strong>Manjaro:</strong> Version 21.0 released - improved stability and features.',
            '<strong>Garuda Linux:</strong> Garuda Assistant and Garuda Update added - user-friendly tools.',
            '<strong>EndeavourOS:</strong> ARM support added - Raspberry Pi and ARM devices.',
            'AUR package count exceeded 120,000 user-contributed packages.',
            'Wayland support expanded across all derivatives - modern display protocol.',
            'Package count exceeded 40,000 in official repositories.',
            'Arch Linux community reached 120,000+ active users.',
            'Better virtualization support - improved KVM and QEMU integration.',
            'Enhanced development tools - better IDE and compiler support.'
        ]
    },
    2022: {
        title: 'Maturity and Stability',
        details: [
            '<strong>Arch Linux:</strong> Pacman 6.1 update released - bug fixes and optimizations.',
            '<strong>Manjaro:</strong> Version 22.0 released - "Sikaris" with major improvements.',
            '<strong>Garuda Linux:</strong> Garuda Linux Tools developed - comprehensive system management.',
            '<strong>EndeavourOS:</strong> First LTS release published - long-term support option.',
            'AUR package count exceeded 130,000 user-contributed packages.',
            'Security and performance improvements made across all derivatives.',
            'Package count exceeded 42,000 in official repositories.',
            'Arch Linux community reached 130,000+ active users.',
            'Better AI/ML support - improved machine learning tools and libraries.',
            'Enhanced containerization - better Docker, Podman, and Kubernetes support.'
        ]
    },
    2023: {
        title: 'Modern Technologies',
        details: [
            '<strong>Arch Linux:</strong> Pacman 6.2 update released - continued improvements.',
            '<strong>Manjaro:</strong> Version 23.0 released - "Uranos" with new features.',
            '<strong>Garuda Linux:</strong> Garuda Boot Manager added - easy boot configuration.',
            '<strong>EndeavourOS:</strong> New desktop environments added - more customization options.',
            'AUR package count exceeded 140,000 user-contributed packages.',
            'Modern Linux kernel and graphics driver support added across all derivatives.',
            'Package count exceeded 45,000 in official repositories.',
            'Arch Linux community reached 140,000+ active users.',
            'Better cloud-native support - improved cloud development tools.',
            'Enhanced gaming experience - better Steam, Proton, and gaming tools.'
        ]
    },
    2024: {
        title: 'EndeavourOS\'s Leadership',
        details: [
            '<strong>EndeavourOS:</strong> Became the fastest-growing distribution among Arch derivatives - rapid adoption.',
            '<strong>Manjaro:</strong> Version 24.0 released - "Womla" with major updates.',
            '<strong>Garuda Linux:</strong> Garuda Linux 2024 version released - performance-focused features.',
            '<strong>Arch Linux:</strong> Pacman 6.3 update released - latest improvements.',
            'AUR package count exceeded 150,000 user-contributed packages - massive ecosystem.',
            'EndeavourOS: Offers the closest experience to Arch Linux with its terminal-focused approach.',
            'Package count exceeded 48,000 in official repositories.',
            'Arch Linux community reached 150,000+ active users.',
            'Better AI integration - improved AI/ML tools and frameworks.',
            'Enhanced security - better encryption, VPN, and privacy tools.'
        ]
    },
    2025: {
        title: 'Future and Innovation',
        details: [
            '<strong>Manjaro:</strong> Version 25.0 released, continues to be the most popular Arch derivative - millions of users.',
            '<strong>EndeavourOS:</strong> Community support and user count continue to grow - strong momentum.',
            '<strong>Garuda Linux:</strong> Performance optimizations and new features added - cutting-edge technology.',
            '<strong>Arch Linux:</strong> Pacman 7.0 development started - next-generation package management.',
            'AUR package count exceeded 160,000 user-contributed packages - largest repository ecosystem.',
            'AI and machine learning tools support expanded across all derivatives - modern development.',
            'Wayland and modern graphics technologies fully supported - future-proof display system.',
            'Package count exceeded 50,000 in official repositories - comprehensive software availability.',
            'Arch Linux community reached 160,000+ active users - thriving ecosystem.',
            'Better IoT support - improved Internet of Things device compatibility.',
            'Enhanced cloud integration - better cloud services and tools support.'
        ]
    }
};

const allDistros = new Set();
Object.values(data).forEach(yearData => {
    Object.keys(yearData).forEach(distro => allDistros.add(distro));
});

let currentYear = 2002;
let isPlaying = false;
let animationInterval = null;
let animationSpeed = 1.5;
let barItems = new Map();
let currentPositions = new Map();
let valueAnimations = new Map(); 
let barWidths = new Map();

const chart = document.getElementById('chart');
const yearDisplay = document.getElementById('year-display');
const infoContent = document.getElementById('info-content');

const BAR_HEIGHT = 50;
const BAR_GAP = 8;
const TOP_10_COUNT = 10;

function initializeBars() {
    chart.innerHTML = '';
    barItems.clear();
    currentPositions.clear();
    valueAnimations.clear();
    barWidths.clear();
    
    allDistros.forEach(distro => {
        const barItem = document.createElement('div');
        barItem.className = 'bar-item';
        barItem.dataset.distro = distro;
        barItem.style.position = 'absolute';
        barItem.style.width = '100%';
        barItem.style.height = `${BAR_HEIGHT}px`;
        barItem.style.opacity = '0';
        barItem.style.transform = 'translate3d(0, 0, 0)';
        barItem.style.transition = 'transform 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 1.2s ease-out';
        barItem.style.willChange = 'transform, opacity';
        
        const rankDiv = document.createElement('div');
        rankDiv.className = 'rank';
        rankDiv.textContent = '0';
        
        const nameDiv = document.createElement('div');
        nameDiv.className = 'distro-name';
        
        const logoImg = document.createElement('img');
        logoImg.className = 'distro-logo';
        logoImg.src = distroLogos[distro] || 'src/logo/archlinux.png';
        logoImg.alt = distro;
        logoImg.onerror = function() {
            this.style.display = 'none';
        };
        
        const nameText = document.createElement('span');
        nameText.textContent = distro;
        
        nameDiv.appendChild(logoImg);
        nameDiv.appendChild(nameText);
        
        const barWrapper = document.createElement('div');
        barWrapper.className = 'bar-wrapper';
        
        const bar = document.createElement('div');
        bar.className = `bar ${distroClasses[distro] || 'arch-linux'}`;
        bar.style.width = '0%';
        bar.style.transition = 'width 7s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
        bar.style.willChange = 'width';
        bar.style.transform = 'translateZ(0)';
        bar.style.backfaceVisibility = 'hidden';
        bar.style.perspective = '1000px';
        
        const valueDiv = document.createElement('div');
        valueDiv.className = 'value';
        valueDiv.textContent = '0%';
        
        barWrapper.appendChild(bar);
        barWrapper.appendChild(valueDiv);
        
        barItem.appendChild(rankDiv);
        barItem.appendChild(nameDiv);
        barItem.appendChild(barWrapper);
        
        chart.appendChild(barItem);
        barItems.set(distro, {
            element: barItem,
            rank: rankDiv,
            bar: bar,
            value: valueDiv,
            currentValue: 0,
            currentWidth: 0
        });
        currentPositions.set(distro, -1);
        barWidths.set(distro, 0);
    });
}

function getSortedDistros(year) {
    const yearData = data[year] || {};
    return Object.entries(yearData)
        .filter(([name, value]) => value > 0)
        .sort((a, b) => b[1] - a[1])
        .slice(0, TOP_10_COUNT);
}

function animatePercentage(item, targetPercentage, duration = 800) {
    const startValue = item.currentValue;
    const difference = targetPercentage - startValue;
    
    if (valueAnimations.has(item.value)) {
        cancelAnimationFrame(valueAnimations.get(item.value));
    }
    
    if (Math.abs(difference) < 0.01) {
        item.value.textContent = `${targetPercentage.toFixed(1)}%`;
        item.currentValue = targetPercentage;
        return;
    }
    
    const startTime = performance.now();
    
    function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        const easeOutCubic = 1 - Math.pow(1 - progress, 3);
        const current = startValue + difference * easeOutCubic;
        
        item.value.textContent = `${current.toFixed(1)}%`;
        item.currentValue = current;
        
        if (progress < 1) {
            const frameId = requestAnimationFrame(update);
            valueAnimations.set(item.value, frameId);
        } else {
            item.value.textContent = `${targetPercentage.toFixed(1)}%`;
            item.currentValue = targetPercentage;
            valueAnimations.delete(item.value);
        }
    }
    
    const frameId = requestAnimationFrame(update);
    valueAnimations.set(item.value, frameId);
}

function updateChart() {
    const sortedDistros = getSortedDistros(currentYear);
    if (sortedDistros.length === 0) return;
    
    const maxValue = Math.max(...sortedDistros.map(d => d[1]));
    
    const yearData = data[currentYear] || {};
    const totalValue = Object.values(yearData).reduce((sum, val) => sum + val, 0);
    
    const newPositions = new Map();
    sortedDistros.forEach(([name, value], index) => {
        newPositions.set(name, index);
    });
    
    const updates = [];
    
    allDistros.forEach(distro => {
        const item = barItems.get(distro);
        if (!item) return;
        
        const newPosition = newPositions.get(distro);
        const oldPosition = currentPositions.get(distro);
        const value = yearData[distro] || 0;
        
        const barPercentage = maxValue > 0 ? (value / maxValue) * 100 : 0;
        
        const displayPercentage = totalValue > 0 ? (value / totalValue) * 100 : 0;
        
        if (newPosition !== undefined && newPosition < TOP_10_COUNT && value > 0) {
            updates.push({
                item,
                distro,
                yPosition: newPosition * (BAR_HEIGHT + BAR_GAP),
                rank: newPosition + 1,
                barPercentage,
                displayPercentage,
                value,
                opacity: 1,
                zIndex: TOP_10_COUNT - newPosition
            });
            currentPositions.set(distro, newPosition);
        } else if (oldPosition !== -1) {
            updates.push({
                item,
                distro,
                yPosition: oldPosition * (BAR_HEIGHT + BAR_GAP),
                rank: 0,
                barPercentage: 0,
                displayPercentage: 0,
                value: 0,
                opacity: 0,
                zIndex: 0
            });
            currentPositions.set(distro, -1);
        }
    });
    
    updates.forEach(({ item, distro, yPosition, rank, barPercentage, displayPercentage, value, opacity, zIndex }) => {
        item.element.style.transform = `translate3d(0, ${yPosition}px, 0)`;
        item.element.style.opacity = opacity;
        item.element.style.zIndex = zIndex;
        
        if (rank > 0) {
            const currentRank = parseInt(item.rank.textContent) || 0;
            if (currentRank !== rank) {
                item.rank.textContent = rank;
                item.rank.style.transition = 'transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1)';
                item.rank.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    item.rank.style.transform = 'scale(1)';
                }, 150);
            }
            
            const currentBarWidth = barWidths.get(distro) || 0;
            if (Math.abs(currentBarWidth - barPercentage) > 0.1) {
                item.bar.style.width = `${barPercentage}%`;
                barWidths.set(distro, barPercentage);
            }
            
            animatePercentage(item, displayPercentage, 800);
        } else {
            item.bar.style.width = '0%';
            item.value.textContent = '0%';
            item.currentValue = 0;
            if (distro) {
                barWidths.set(distro, 0);
            }
        }
    });
    
    yearDisplay.textContent = currentYear;
    
    updateInfoBox();
}

function updateInfoBox() {
    const info = yearInfo[currentYear];
    if (!info) {
        infoContent.innerHTML = '<p>No information available for this year.</p>';
        return;
    }
    
    let html = `<p><strong style="color: #1793d1; font-size: 16px;">${info.title}</strong></p>`;
    
    if (info.details && info.details.length > 0) {
        html += '<ul style="margin-top: 10px;">';
        info.details.forEach(detail => {
            html += `<li style="margin: 8px 0;">${detail}</li>`;
        });
        html += '</ul>';
    }
    
    infoContent.innerHTML = html;
}


function playAnimation() {
    isPlaying = true;
    
    const years = Object.keys(data).map(Number).sort((a, b) => a - b);
    
    animationInterval = setInterval(() => {
        const currentIndex = years.indexOf(currentYear);
        let nextIndex = currentIndex + 1;
        
        if (nextIndex >= years.length) {
            nextIndex = 0;
        }
        
        currentYear = years[nextIndex];
        updateChart();
    }, 8000 / animationSpeed); 
}

function pauseAnimation() {
    isPlaying = false;
    if (animationInterval) {
        clearInterval(animationInterval);
        animationInterval = null;
    }
}

initializeBars();
setTimeout(() => {
    updateChart();
    playAnimation();
}, 500);

document.addEventListener('keydown', (e) => {
    if (e.key === ' ' || e.key === 'Space') {
        e.preventDefault();
        if (isPlaying) {
            pauseAnimation();
        } else {
            playAnimation();
        }
    } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        pauseAnimation();
        const years = Object.keys(data).map(Number).sort((a, b) => a - b);
        const currentIndex = years.indexOf(currentYear);
        if (currentIndex > 0) {
            currentYear = years[currentIndex - 1];
            updateChart();
        }
    } else if (e.key === 'ArrowRight') {
        e.preventDefault();
        pauseAnimation();
        const years = Object.keys(data).map(Number).sort((a, b) => a - b);
        const currentIndex = years.indexOf(currentYear);
        if (currentIndex < years.length - 1) {
            currentYear = years[currentIndex + 1];
            updateChart();
        }
    } else if (e.key === 'r' || e.key === 'R') {
        e.preventDefault();
        pauseAnimation();
        currentYear = 2002;
        updateChart();
        setTimeout(() => {
            playAnimation();
        }, 500);
    } else if (e.key === '+' || e.key === '=') {
        e.preventDefault();
        if (animationSpeed < 10) {
            animationSpeed++;
            if (isPlaying) {
                pauseAnimation();
                playAnimation();
            }
        }
    } else if (e.key === '-' || e.key === '_') {
        e.preventDefault();
        if (animationSpeed > 1) {
            animationSpeed--;
            if (isPlaying) {
                pauseAnimation();
                playAnimation();
            }
        }
    }
});
